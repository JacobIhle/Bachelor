// OpenSeadragonScaleBar bafd4b2
/* 
 * This software was developed at the National Institute of Standards and
 * Technology by employees of the Federal Government in the course of
 * their official duties. Pursuant to title 17 Section 105 of the United
 * States Code this software is not subject to copyright protection and is
 * in the public domain. This software is an experimental system. NIST assumes
 * no responsibility whatsoever for its use by other parties, and makes no
 * guarantees, expressed or implied, about its quality, reliability, or
 * any other characteristic. We would appreciate acknowledgement if the
 * software is used.
 */
(function(e){function g(a,b,c,d){var e=l(a,b);a=m(e/a*b,3);return{size:e*b,text:a+" "+c+(d&&1<a?"s":"")}}function h(a,b,c){var d=l(a,b);a=m(d/a*b,3);return{size:d*b,text:1E-6>a?1E9*a+" n"+c:.001>a?1E6*a+" \u03bc"+c:1>a?1E3*a+" m"+c:1E3<=a?a/1E3+" k"+c:a+" "+c}}function l(a,b){var c=k(a),d=k(b),c=k(c/d);5<=c&&(c/=5);4<=c&&(c/=4);2<=c&&(c/=2);return c}function k(a){return a*Math.pow(10,Math.ceil(-(Math.log(a)/Math.log(10))))}function m(a,b){var c=-Math.ceil(-(Math.log(a)/Math.log(10))),c=b-c,d=a*Math.pow(10,
c);return 0>c?Math.round(d)*Math.pow(10,-c):Math.round(d)/Math.pow(10,c)}function f(a){return"undefined"!==typeof a}if(!e.version||1>e.version.major)throw Error("OpenSeadragonScalebar requires OpenSeadragon version 1.0.0+");e.Viewer.prototype.scalebar=function(a){this.scalebarInstance?this.scalebarInstance.refresh(a):(a=a||{},a.viewer=this,this.scalebarInstance=new e.Scalebar(a))};e.ScalebarType={NONE:0,MICROSCOPY:1,MAP:2};e.ScalebarLocation={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4};
e.Scalebar=function(a){a=a||{};if(!a.viewer)throw Error("A viewer must be specified.");this.viewer=a.viewer;this.divElt=document.createElement("div");this.viewer.container.appendChild(this.divElt);this.divElt.style.position="relative";this.divElt.style.margin="0";this.divElt.style.pointerEvents="none";this.setMinWidth(a.minWidth||"150px");this.setDrawScalebarFunction(a.type||e.ScalebarType.MICROSCOPY);this.color=a.color||"black";this.fontColor=a.fontColor||"black";this.backgroundColor=a.backgroundColor||
"none";this.fontSize=a.fontSize||"";this.barThickness=a.barThickness||2;this.pixelsPerMeter=a.pixelsPerMeter||null;this.location=a.location||e.ScalebarLocation.BOTTOM_LEFT;this.xOffset=a.xOffset||5;this.yOffset=a.yOffset||5;this.stayInsideImage=f(a.stayInsideImage)?a.stayInsideImage:!0;this.sizeAndTextRenderer=a.sizeAndTextRenderer||e.ScalebarSizeAndTextRenderer.METRIC_LENGTH;var b=this;this.viewer.addHandler("open",function(){b.refresh()});this.viewer.addHandler("animation",function(){b.refresh()});
this.viewer.addHandler("resize",function(){b.refresh()})};e.Scalebar.prototype={updateOptions:function(a){a&&(f(a.type)&&this.setDrawScalebarFunction(a.type),f(a.minWidth)&&this.setMinWidth(a.minWidth),f(a.color)&&(this.color=a.color),f(a.fontColor)&&(this.fontColor=a.fontColor),f(a.backgroundColor)&&(this.backgroundColor=a.backgroundColor),f(a.fontSize)&&(this.fontSize=a.fontSize),f(a.barThickness)&&(this.barThickness=a.barThickness),f(a.pixelsPerMeter)&&(this.pixelsPerMeter=a.pixelsPerMeter),f(a.location)&&
(this.location=a.location),f(a.xOffset)&&(this.xOffset=a.xOffset),f(a.yOffset)&&(this.yOffset=a.yOffset),f(a.stayInsideImage)&&(this.stayInsideImage=a.stayInsideImage),f(a.sizeAndTextRenderer)&&(this.sizeAndTextRenderer=a.sizeAndTextRenderer))},setDrawScalebarFunction:function(a){this.drawScalebar=a?a===e.ScalebarType.MAP?this.drawMapScalebar:this.drawMicroscopyScalebar:null},setMinWidth:function(a){this.divElt.style.width=a;this.divElt.style.display="";this.minWidth=this.divElt.offsetWidth},refresh:function(a){this.updateOptions(a);
this.viewer.isOpen()&&this.drawScalebar&&this.pixelsPerMeter&&this.location?(this.divElt.style.display="",a=this.viewer.viewport,a=a.viewportToImageZoom(a.getZoom(!0))*this.pixelsPerMeter,a=this.sizeAndTextRenderer(a,this.minWidth),this.drawScalebar(a.size,a.text),a=this.getScalebarLocation(),this.divElt.style.left=a.x+"px",this.divElt.style.top=a.y+"px"):this.divElt.style.display="none"},drawMicroscopyScalebar:function(a,b){this.divElt.style.fontSize=this.fontSize;this.divElt.style.textAlign="center";
this.divElt.style.color=this.fontColor;this.divElt.style.border="none";this.divElt.style.borderBottom=this.barThickness+"px solid "+this.color;this.divElt.style.backgroundColor=this.backgroundColor;this.divElt.innerHTML=b;this.divElt.style.width=a+"px"},drawMapScalebar:function(a,b){this.divElt.style.fontSize=this.fontSize;this.divElt.style.textAlign="center";this.divElt.style.color=this.fontColor;this.divElt.style.border=this.barThickness+"px solid "+this.color;this.divElt.style.borderTop="none";
this.divElt.style.backgroundColor=this.backgroundColor;this.divElt.innerHTML=b;this.divElt.style.width=a+"px"},getScalebarLocation:function(){if(this.location===e.ScalebarLocation.TOP_LEFT){var a=0,b=0;if(this.stayInsideImage){var c=this.viewer.viewport.pixelFromPoint(new e.Point(0,0),!0);this.viewer.wrapHorizontal||(a=Math.max(c.x,0));this.viewer.wrapVertical||(b=Math.max(c.y,0))}return new e.Point(a+this.xOffset,b+this.yOffset)}if(this.location===e.ScalebarLocation.TOP_RIGHT){var d=this.divElt.offsetWidth,
b=this.viewer.container,a=b.offsetWidth-d,b=0;this.stayInsideImage&&(c=this.viewer.viewport.pixelFromPoint(new e.Point(1,0),!0),this.viewer.wrapHorizontal||(a=Math.min(a,c.x-d)),this.viewer.wrapVertical||(b=Math.max(b,c.y)));return new e.Point(a-this.xOffset,b+this.yOffset)}if(this.location===e.ScalebarLocation.BOTTOM_RIGHT){var d=this.divElt.offsetWidth,f=this.divElt.offsetHeight,b=this.viewer.container,a=b.offsetWidth-d,b=b.offsetHeight-f;this.stayInsideImage&&(c=this.viewer.viewport.pixelFromPoint(new e.Point(1,
1/this.viewer.source.aspectRatio),!0),this.viewer.wrapHorizontal||(a=Math.min(a,c.x-d)),this.viewer.wrapVertical||(b=Math.min(b,c.y-f)));return new e.Point(a-this.xOffset,b-this.yOffset)}if(this.location===e.ScalebarLocation.BOTTOM_LEFT)return f=this.divElt.offsetHeight,b=this.viewer.container,a=0,b=b.offsetHeight-f,this.stayInsideImage&&(c=this.viewer.viewport.pixelFromPoint(new e.Point(0,1/this.viewer.source.aspectRatio),!0),this.viewer.wrapHorizontal||(a=Math.max(a,c.x)),this.viewer.wrapVertical||
(b=Math.min(b,c.y-f))),new e.Point(a+this.xOffset,b-this.yOffset)}};e.ScalebarSizeAndTextRenderer={METRIC_LENGTH:function(a,b){return h(a,b,"m")},IMPERIAL_LENGTH:function(a,b){var c=2*b,d=.0254*a;if(c<12*d)return c<d?g(d/1E3,b,"th"):g(d,b,"in");d*=12;return c<2E3*d?g(d,b,"ft"):g(5280*d,b,"mi")},STANDARD_TIME:function(a,b){var c=2*b;if(c<60*a)return h(a,b,"s",!1);var d=60*a;if(c<60*d)return g(d,b,"minute",!0);d*=60;if(c<24*d)return g(d,b,"hour",!0);d*=24;return c<365.25*d?g(d,b,"day",!0):g(365.25*
d,b,"year",!0)},METRIC_GENERIC:h}})(OpenSeadragon);
